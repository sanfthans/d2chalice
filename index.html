<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://unpkg.com/stimulus/dist/stimulus.umd.js"></script>
  <script>
    (() => {
      const application = Stimulus.Application.start()

      application.register("chalice", class extends Stimulus.Controller {
        static get targets() {
          return [ "slot",
                   "slotOne", "slotOneName", "slotOnePicker",
                   "slotTwo", "slotTwoName", "slotTwoPicker",
                   "slotThree", "slotThreeName", "slotThreePicker",
                   "result" ]
        }

        togglePicker(e) {
          let slot = e.target.closest(".slot")
          slot.classList.toggle("is-open")
          this.slotTargets.forEach(el => {
            if (el !== slot) {
              el.classList.remove("is-open")
            }
          })
        }

        makeSelection(e) {
          // update slot image
          let slot = e.target.closest(".slot")
          let selected = e.target.src
          slot.querySelector("img").src = selected

          // update text
          let name = selected.replace(/^.*[\\\/]/, '').split(".")[0]
          name = name.charAt(0).toUpperCase() + name.slice(1)
          slot.querySelector(".slot-name").innerHTML = name

          // close other pickers
          this.slotTargets.forEach(el => {
            el.classList.remove("is-open")
          })
        }

      })
    })()
  </script>
  <style media="screen">
    .container {
      max-width: 600px;
      margin: 100px auto 0;
    }
    .slot {
      display: flex;
      justify-content: center;
      position:relative;
    }
    .slot-name {
      position: absolute;
      top: -20px;
      color: white;
    }
    .picker {
      display: none;
      position: absolute;
      top: 100px;
      width: 300px;
      flex-wrap: wrap;
    }
    .picker img {
      width: 50px;
      height: 50px;
    }
    .slot.is-open .picker {
      display: flex;
    }
    .slot-container {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
  </style>
<head>
<body style="background-color:#252525;">
  <div class="container" data-controller="chalice">

    <div class="slot"
      data-target="chalice.slotOne chalice.slot"
      data-slot="1">
      <img src="images/slot.png" data-action="click->chalice#togglePicker">
      <div class="slot-name" data-target="chalice.slotOneName"></div>
      <div class="picker"
        data-target="chalice.slotOnePicker">
        <img src="images/beast.png" data-action="click->chalice#makeSelection">
        <img src="images/joy.png" data-action="click->chalice#makeSelection">
        <img src="images/jubilation.png" data-action="click->chalice#makeSelection">
        <img src="images/ambition.png" data-action="click->chalice#makeSelection">
        <img src="images/cunning.png" data-action="click->chalice#makeSelection">
        <img src="images/gluttony.png" data-action="click->chalice#makeSelection">
        <img src="images/desire.png" data-action="click->chalice#makeSelection">
        <img src="images/pride.png" data-action="click->chalice#makeSelection">
        <img src="images/war.png" data-action="click->chalice#makeSelection">
        <img src="images/excess.png" data-action="click->chalice#makeSelection">
        <img src="images/pleasure.png" data-action="click->chalice#makeSelection">
        <img src="images/wealth.png" data-action="click->chalice#makeSelection">
      </div>
    </div>

    <div class="slot-container">
      <div class="slot"
        data-target="chalice.slotTwo chalice.slot"
        data-slot="2">
        <img src="images/slot.png" data-action="click->chalice#togglePicker">
        <div class="slot-name" data-target="chalice.slotTwoName"></div>
        <div class="picker"
          data-target="chalice.slotTwoPicker">
          <img src="images/beast.png" data-action="click->chalice#makeSelection">
          <img src="images/joy.png" data-action="click->chalice#makeSelection">
          <img src="images/jubilation.png" data-action="click->chalice#makeSelection">
          <img src="images/ambition.png" data-action="click->chalice#makeSelection">
          <img src="images/cunning.png" data-action="click->chalice#makeSelection">
          <img src="images/gluttony.png" data-action="click->chalice#makeSelection">
          <img src="images/desire.png" data-action="click->chalice#makeSelection">
          <img src="images/pride.png" data-action="click->chalice#makeSelection">
          <img src="images/war.png" data-action="click->chalice#makeSelection">
          <img src="images/excess.png" data-action="click->chalice#makeSelection">
          <img src="images/pleasure.png" data-action="click->chalice#makeSelection">
          <img src="images/wealth.png" data-action="click->chalice#makeSelection">
        </div>
      </div>

      <div class="slot"
        data-target="chalice.slotThree chalice.slot"
        data-slot="3">
        <img src="images/slot.png" data-action="click->chalice#togglePicker">
        <div class="slot-name" data-target="chalice.slotThreeName"></div>
        <div class="picker"
          data-target="chalice.slotThreePicker">
          <img src="images/beast.png" data-action="click->chalice#makeSelection">
          <img src="images/joy.png" data-action="click->chalice#makeSelection">
          <img src="images/jubilation.png" data-action="click->chalice#makeSelection">
          <img src="images/ambition.png" data-action="click->chalice#makeSelection">
          <img src="images/cunning.png" data-action="click->chalice#makeSelection">
          <img src="images/gluttony.png" data-action="click->chalice#makeSelection">
          <img src="images/desire.png" data-action="click->chalice#makeSelection">
          <img src="images/pride.png" data-action="click->chalice#makeSelection">
          <img src="images/war.png" data-action="click->chalice#makeSelection">
          <img src="images/excess.png" data-action="click->chalice#makeSelection">
          <img src="images/pleasure.png" data-action="click->chalice#makeSelection">
          <img src="images/wealth.png" data-action="click->chalice#makeSelection">
        </div>
      </div>
    </div>

    <div data-target="chalice.result">
    </div>
  </div>
</body>
</html>
